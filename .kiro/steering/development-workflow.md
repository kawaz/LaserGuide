---
inclusion: always
---

# 開発ワークフローとコミット管理

## 環境設定
- **PAGER環境変数**: AIエージェント作業開始時にターミナルで `export PAGER=""` を実行してページャーを無効化
- **理由**: `git diff`, `gh run view` 等でlessが起動してエージェントの作業が停止するのを防ぐ
- **注意**: 個別コマンドに `PAGER=""` を付けるのではなく、セッション全体で環境変数を設定する

## ブランチ管理
- **フィーチャーブランチを使用**: 大きな変更は必ずフィーチャーブランチで作業
- **機能開発**: feature/ ブランチで行う
- **バグ修正**: fix/ ブランチで行う
- **ホットフィックス**: hotfix/ ブランチで行う
- **マージ前に承認を得る**: mainにマージする前に変更を人間に説明し、確認を得る

## コミット作成ルール
- **適切なコミットを常に作成**: 明確なメッセージで原子的なコミットを作成
- **コンベンショナルコミットを使用**: `feat:`、`fix:`、`docs:`、`chore:`、`refactor:`、`test:`
- **定期的にコミット**: 単一のコミットに多くの変更を蓄積しない
- **コミットメッセージは日本語で記述**
- **コミットメッセージの形式**：
  - 1行目：プレフィックス + 変更の概要（50文字以内）
  - 2行目：空行
  - 3行目以降：詳細な説明（必要に応じて）

## バージョン管理
- **自動バージョニング**: mainにマージされたPRが自動リリースをトリガー
- **バージョン決定**: 
  - `feat:` → マイナーバージョンアップ
  - その他のコード変更 → パッチバージョンアップ
  - ドキュメントのみの変更 → リリースなし

## 実装フロー
1. 機能設計・要件定義
2. フィーチャーブランチ作成
3. 基本実装
4. `make dev`でローカルテスト
5. テスト追加
6. ドキュメント更新（英語版・日本語版両方）
7. 各ステップでコミット作成
8. 人間に説明して承認を得る
9. mainにマージ

## ドキュメント管理
- **同期を保つ**: コード変更時、関連ドキュメントを必ず更新
- **英語版・日本語版の両方を更新**: README.md/README.ja.md、CONTRIBUTING.md/CONTRIBUTING.ja.md等
- **単一の情報源**: ファイル間でコンテンツを重複させない
- **相互参照**: 重複させるのではなくドキュメント間でリンク

## コード品質とテスト
- **push前の必須チェック**: 
  1. `swiftlint lint --strict` でコード品質確認
  2. `make test` または `xcodebuild test` でテスト実行
  3. `make dev` でローカル動作確認
- **`make dev`を使用**: デバッグ版をビルドして実行し、変更をテスト
- **既存機能を確認**: 変更前に現在の動作を理解
- **適切なテストカバレッジを維持**
- **リファクタリングは別コミットで行う**
- **リファクタリング後のクリーンアップ**: 不要になったファイルがないか常に確認し削除

## 重要な注意事項
- **ブランチの規律**: 大きな変更は必ずフィーチャーブランチで作業
- **人間の承認**: 大きな変更をmainにマージする前に確認を得る
- **セキュリティ**: シークレットやAPIキーを決してコミットしない
- **コードスタイル**: 既存のSwiftパターンと規約に従う